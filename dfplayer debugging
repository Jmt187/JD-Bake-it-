/***************************************************
DFPlayer - Diagnostic version to find where code hangs
 ****************************************************/

#include "Arduino.h"
#include "DFRobotDFPlayerMini.h"
#include <SoftwareSerial.h>

SoftwareSerial softSerial(/*rx =*/9, /*tx =*/10);
DFRobotDFPlayerMini myDFPlayer;

const int ERROR_LED = 8;
const int SUCCESS_LED = 7;

// Function to blink a pattern to show progress
void blinkPattern(int led, int count) {
  for(int i = 0; i < count; i++) {
    digitalWrite(led, HIGH);
    delay(150);
    digitalWrite(led, LOW);
    delay(150);
  }
  delay(500);
}

void setup()
{
  pinMode(ERROR_LED, OUTPUT);
  pinMode(SUCCESS_LED, OUTPUT);
  
  // Checkpoint 1: Setup started
  blinkPattern(SUCCESS_LED, 1);
  
  softSerial.begin(9600);
  delay(1500);
  
  // Checkpoint 2: Serial initialized
  blinkPattern(SUCCESS_LED, 2);
  
  // Try to initialize DFPlayer (NO error checking - just do it)
  myDFPlayer.begin(softSerial, false, false);  // No ACK, no reset
  
  delay(1000);
  
  // Checkpoint 3: DFPlayer begin() completed
  blinkPattern(SUCCESS_LED, 3);
  
  // Try volume command
  myDFPlayer.volume(20);
  
  delay(500);
  
  // Checkpoint 4: Volume command completed
  blinkPattern(SUCCESS_LED, 4);
  
  // Try play command
  myDFPlayer.play(1);
  
  delay(500);
  
  // Checkpoint 5: Play command completed
  blinkPattern(SUCCESS_LED, 5);
  
  // If we get here, setup is complete!
  // Turn on ERROR_LED solid to indicate success
  digitalWrite(ERROR_LED, HIGH);
}

void loop()
{
  // Slow heartbeat on SUCCESS_LED
  digitalWrite(SUCCESS_LED, HIGH);
  delay(1000);
  digitalWrite(SUCCESS_LED, LOW);
  delay(1000);
}
